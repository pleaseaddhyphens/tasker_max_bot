# üåÖ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –†–∏—Ç—É–∞–ª–∞–º

## –ß—Ç–æ —Ç–∞–∫–æ–µ –†–∏—Ç—É–∞–ª—ã?

–†–∏—Ç—É–∞–ª—ã - —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –≤ –∑–∞–¥–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏—Ö —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏—è. –ï—Å—Ç—å –¥–≤–∞ —Ç–∏–ø–∞ —Ä–∏—Ç—É–∞–ª–æ–≤:

- **–£—Ç—Ä–µ–Ω–Ω–∏–π —Ä–∏—Ç—É–∞–ª** üåÖ - –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ã–π –¥–µ–Ω—å
- **–í–µ—á–µ—Ä–Ω–∏–π —Ä–∏—Ç—É–∞–ª** üåô - –¥–ª—è —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏—è –∏ —É—Å–ø–æ–∫–æ–µ–Ω–∏—è

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

–î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ–≤–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å: `APScheduler==3.10.4`

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∏—Ç—É–∞–ª–æ–≤

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –≤—Ä–µ–º—è —Ä–∏—Ç—É–∞–ª–æ–≤ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É `/start` –≤ –±–æ—Ç–µ:

1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start` –≤ MAX –±–æ—Ç–µ
2. –í–≤–µ–¥–∏—Ç–µ –≤—Ä–µ–º—è —É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Ä–∏—Ç—É–∞–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `08:00`)
3. –í–≤–µ–¥–∏—Ç–µ –≤—Ä–µ–º—è –≤–µ—á–µ—Ä–Ω–µ–≥–æ —Ä–∏—Ç—É–∞–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `21:00`)
4. –ì–æ—Ç–æ–≤–æ! –ë–æ—Ç –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ä–∏—Ç—É–∞–ª—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### 3. –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ —Å —Ä–∏—Ç—É–∞–ª–∞–º–∏

```bash
python longpolling_bot.py
```

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ó–∞–ø—É—Å—Ç–∏—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Ä–∏—Ç—É–∞–ª–æ–≤
- –ë—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å –≤—Ä–µ–º—è –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
- –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ä–∏—Ç—É–∞–ª—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –≤ –∑–∞–¥–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è

## üìù –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤ —Ä–∏—Ç—É–∞–ª–æ–≤

–¢–µ–∫—Å—Ç—ã —Ä–∏—Ç—É–∞–ª–æ–≤ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `ritual_config.py`:

```python
RITUALS = {
    "morning": {
        "text": "–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –ö–∞–∫ —Ç—ã —Å–µ–±—è —á—É–≤—Å—Ç–≤—É–µ—à—å? –ù—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—Å—è –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ã–π —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å",
        "image_path": os.path.join(BASE_DIR, "pictures", "ritual_pig.jpg"),
        "description": "–£—Ç—Ä–µ–Ω–Ω–∏–π —Ä–∏—Ç—É–∞–ª –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ã–π –¥–µ–Ω—å"
    },
    "evening": {
        "text": "–î–æ–±—Ä—ã–π –≤–µ—á–µ—Ä! –ö–∞–∫ —Ç—ã —Å–µ–±—è —á—É–≤—Å—Ç–≤—É–µ—à—å? –ø–æ–¥ –≤–µ—á–µ—Ä –Ω—É–∂–Ω–æ —Ä–∞—Å—Å–ª–∞–±–ª—è—Ç—å—Å—è –∏ —É—Å–ø–æ–∫–∞–∏–≤–∞—Ç—å—Å—è",
        "image_path": os.path.join(BASE_DIR, "pictures", "ritual_pig.jpg"),
        "description": "–í–µ—á–µ—Ä–Ω–∏–π —Ä–∏—Ç—É–∞–ª –¥–ª—è —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏—è –∏ —É—Å–ø–æ–∫–æ–µ–Ω–∏—è"
    }
}
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `ritual_config.py`
2. –ò–∑–º–µ–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ `text` –¥–ª—è –Ω—É–∂–Ω–æ–≥–æ —Ä–∏—Ç—É–∞–ª–∞
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

1. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –ø–∞–ø–∫—É `pictures/`
2. –£–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ –Ω–µ–º—É –≤ `image_path`
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è —É—Ç—Ä–∞ –∏ –≤–µ—á–µ—Ä–∞!

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç

–°–æ–∑–¥–∞–Ω —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç `test_ritual.py` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–∏—Ç—É–∞–ª–æ–≤:

```bash
# –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —É—Ç—Ä–µ–Ω–Ω–∏–π —Ä–∏—Ç—É–∞–ª
python test_ritual.py 94717924 morning

# –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–µ—á–µ—Ä–Ω–∏–π —Ä–∏—Ç—É–∞–ª
python test_ritual.py 94717924 evening

# –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∏
python test_ritual.py 94717924 simple
```

–ì–¥–µ `94717924` - –≤–∞—à ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ MAX.

### –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤—Ä–µ–º—è —Ä–∏—Ç—É–∞–ª–∞ –Ω–∞ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ 2 –º–∏–Ω—É—Ç—ã)
2. –î–æ–∂–¥–∏—Ç–µ—Å—å —ç—Ç–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
3. –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–∏—Ç—É–∞–ª

## üìä –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
longpolling_bot.py
‚îú‚îÄ‚îÄ init_scheduler()           # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
‚îú‚îÄ‚îÄ check_and_send_rituals()   # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
‚îÇ   ‚îú‚îÄ‚îÄ –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º–∏ —Ä–∏—Ç—É–∞–ª–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ä–µ–º—è
‚îÇ   ‚îî‚îÄ‚îÄ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–∏—Ç—É–∞–ª –µ—Å–ª–∏ –≤—Ä–µ–º—è —Å–æ–≤–ø–∞–¥–∞–µ—Ç
‚îî‚îÄ‚îÄ send_ritual_to_user()      # –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–∏—Ç—É–∞–ª–∞
    ‚îú‚îÄ‚îÄ –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ MAX API
    ‚îî‚îÄ‚îÄ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ç–µ–∫—Å—Ç–æ–º –∏ –∫–∞—Ä—Ç–∏–Ω–∫–æ–π
```

### –ü—Ä–æ—Ü–µ—Å—Å –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

1. **–ü–æ–ª—É—á–∏—Ç—å URL –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏**
   ```
   POST /uploads?type=image
   ‚Üí –ü–æ–ª—É—á–∞–µ–º upload_url
   ```

2. **–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª**
   ```
   POST upload_url (multipart/form-data)
   ‚Üí –ü–æ–ª—É—á–∞–µ–º token
   ```

3. **–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ**
   ```
   POST /messages
   {
     "text": "...",
     "attachments": [{"type": "image", "payload": {"token": "..."}}]
   }
   ```

## üéØ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏—è

### –®–∫–∞–ª–∞ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏—è

–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–∏—Ç—É–∞–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç —Ü–∏—Ñ—Ä–æ–π –æ—Ç 1 –¥–æ 7:

| –£—Ä–æ–≤–µ–Ω—å | –ù–∞–∑–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|----------|
| 1 | –ê–ø–∞—Ç–∏—è | –ù–∏–∑–∫–∞—è —ç–Ω–µ—Ä–≥–∏—è, –Ω–µ—Ç –º–æ—Ç–∏–≤–∞—Ü–∏–∏ |
| 2 | –ü–∞—Å—Å–∏–≤–Ω–æ—Å—Ç—å | –†–∞—Å—Å–ª–∞–±–ª–µ–Ω, –Ω–æ –ø–∞—Å—Å–∏–≤–µ–Ω |
| 3 | –†–∞—Å—Å–ª–∞–±–ª–µ–Ω–Ω–æ—Å—Ç—å | –°–ø–æ–∫–æ–π–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ |
| 4 | –ë–∞–ª–∞–Ω—Å | –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ ‚≠ê |
| 5 | –í–∫–ª—é—á–µ–Ω–Ω–æ—Å—Ç—å | –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å |
| 6 | –ü–µ—Ä–µ–≤–æ–∑–±—É–∂–¥–µ–Ω–Ω–æ—Å—Ç—å | –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —ç–Ω–µ—Ä–≥–∏–∏ |
| 7 | –ü–∞–Ω–∏–∫–∞ | –¢—Ä–µ–≤–æ–≥–∞, —Å—Ç—Ä–µ—Å—Å |

### –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

–í—Å–µ –æ—Ç–≤–µ—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `mood_logs`:

```sql
SELECT * FROM mood_logs ORDER BY logged_at DESC LIMIT 10;
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –§–∞–π–ª—ã

- `longpolling_bot.py` - –æ—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç —Å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º
- `ritual_config.py` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ä–∏—Ç—É–∞–ª–æ–≤
- `test_ritual.py` - —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
- `pictures/ritual_pig.jpg` - –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è —Ä–∏—Ç—É–∞–ª–æ–≤

### –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ longpolling_bot.py

```python
# –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä MAX
async def upload_image_to_max(image_path: str) -> Optional[str]

# –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
async def send_message_with_image(user_id: int, text: str, image_path: str) -> bool

# –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–∏—Ç—É–∞–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
async def send_ritual_to_user(user_id: int, ritual_type: str)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ä–∏—Ç—É–∞–ª–æ–≤ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
async def check_and_send_rituals()

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
async def init_scheduler()

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
async def shutdown_scheduler()
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–¢–∞–±–ª–∏—Ü–∞ `users` —Å–æ–¥–µ—Ä–∂–∏—Ç:
- `morning_ritual_time` - –≤—Ä–µ–º—è —É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Ä–∏—Ç—É–∞–ª–∞
- `evening_ritual_time` - –≤—Ä–µ–º—è –≤–µ—á–µ—Ä–Ω–µ–≥–æ —Ä–∏—Ç—É–∞–ª–∞
- `onboarding_step` - —Å—Ç–∞—Ç—É—Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–¢–∞–±–ª–∏—Ü–∞ `mood_logs` —Å–æ–¥–µ—Ä–∂–∏—Ç:
- `user_id` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `mood_level` - —É—Ä–æ–≤–µ–Ω—å —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏—è (1-7)
- `ritual_type` - —Ç–∏–ø —Ä–∏—Ç—É–∞–ª–∞ (morning/evening)
- `logged_at` - –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏

## üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω

```bash
ps aux | grep longpolling_bot
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏

–ë–æ—Ç –≤—ã–≤–æ–¥–∏—Ç –ª–æ–≥–∏:

```
‚úÖ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Ä–∏—Ç—É–∞–ª–æ–≤ –∑–∞–ø—É—â–µ–Ω (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É)
üïê –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∏—Ç—É–∞–ª–æ–≤: 08:00
üåÖ –í—Ä–µ–º—è —É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Ä–∏—Ç—É–∞–ª–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 94717924
üåÖ –û—Ç–ø—Ä–∞–≤–∫–∞ morning —Ä–∏—Ç—É–∞–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é 94717924
‚úÖ –§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω, –ø–æ–ª—É—á–µ–Ω token
‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é 94717924
‚úÖ –†–∏—Ç—É–∞–ª morning –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é 94717924
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ë–î

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º–∏ —Ä–∏—Ç—É–∞–ª–∞–º–∏
sudo docker exec -it tasker_max_db psql -U tasker_user -d tasker -c "
SELECT 
  max_user_id,
  first_name,
  morning_ritual_time,
  evening_ritual_time,
  onboarding_step
FROM users 
WHERE onboarding_step = 'completed';
"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø–∏—Å–∏ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏—è
sudo docker exec -it tasker_max_db psql -U tasker_user -d tasker -c "
SELECT 
  user_id,
  mood_level,
  ritual_type,
  logged_at
FROM mood_logs 
ORDER BY logged_at DESC 
LIMIT 10;
"
```

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –†–∏—Ç—É–∞–ª—ã –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–ø—É—â–µ–Ω**
   - –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å: `‚úÖ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Ä–∏—Ç—É–∞–ª–æ–≤ –∑–∞–ø—É—â–µ–Ω`

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Ä–µ–º—è –≤ –ë–î**
   ```sql
   SELECT morning_ritual_time, evening_ritual_time FROM users WHERE max_user_id = YOUR_ID;
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å**
   - –ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—Ä–µ–º—è —Å–µ—Ä–≤–µ—Ä–∞
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ: `date`

### –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É**
   ```python
   import os
   print(os.path.exists("pictures/ritual_pig.jpg"))  # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å True
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞**
   - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: JPG, PNG, GIF

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞**
   - MAX API –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —Ä–∞–∑–º–µ—Ä

### –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É APScheduler**
   ```bash
   pip list | grep APScheduler
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏**
   - –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞

## üé® –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è

### –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–∏–ø —Ä–∏—Ç—É–∞–ª–∞

1. –î–æ–±–∞–≤—å—Ç–µ –≤ `ritual_config.py`:
   ```python
   RITUALS = {
       # ...
       "afternoon": {
           "text": "–î–æ–±—Ä—ã–π –¥–µ–Ω—å! –í—Ä–µ–º—è –ø–æ–¥–≤–µ—Å—Ç–∏ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –∏—Ç–æ–≥–∏",
           "image_path": os.path.join(BASE_DIR, "pictures", "afternoon.jpg")
       }
   }
   ```

2. –î–æ–±–∞–≤—å—Ç–µ –ø–æ–ª–µ –≤ –ë–î:
   ```sql
   ALTER TABLE users ADD COLUMN afternoon_ritual_time TIME;
   ```

3. –û–±–Ω–æ–≤–∏—Ç–µ –ª–æ–≥–∏–∫—É –≤ `check_and_send_rituals()`

### –ò–∑–º–µ–Ω–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É –ø—Ä–æ–≤–µ—Ä–∫–∏

–í `init_scheduler()` –∏–∑–º–µ–Ω–∏—Ç–µ:

```python
# –ü—Ä–æ–≤–µ—Ä—è—Ç—å –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
CronTrigger(second=0)

# –ü—Ä–æ–≤–µ—Ä—è—Ç—å –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
CronTrigger(minute='*/5', second=0)

# –ü—Ä–æ–≤–µ—Ä—è—Ç—å –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
CronTrigger(second='*/30')
```

## üìû –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

- `/start` - –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤—Ä–µ–º—è —Ä–∏—Ç—É–∞–ª–æ–≤
- `/–ø–æ–º–æ—â—å` - –ø–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É
- `1-7` - –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å –æ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–∏
- `/–∑–∞–¥–∞—á–∏` - –ø–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á
- `/—Å–æ–∑–¥–∞—Ç—å` - —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É
- `/–≥–æ—Ç–æ–≤–æ {id}` - –æ—Ç–º–µ—Ç–∏—Ç—å –∑–∞–¥–∞—á—É –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π

---

**–í–µ—Ä—Å–∏—è:** 2.0.0  
**–î–∞—Ç–∞:** 14.11.2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∏—Ç—É–∞–ª—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç



