# üåÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –†–∏—Ç—É–∞–ª–æ–≤ - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

## –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

‚úÖ **–û–Ω–±–æ—Ä–¥–∏–Ω–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
- –ö–æ–º–∞–Ω–¥–∞ `/start` –∑–∞–ø—É—Å–∫–∞–µ—Ç –¥–∏–∞–ª–æ–≥ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –ë–æ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –≤—Ä–µ–º—è —É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Ä–∏—Ç—É–∞–ª–∞
- –ë–æ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –≤—Ä–µ–º—è –≤–µ—á–µ—Ä–Ω–µ–≥–æ —Ä–∏—Ç—É–∞–ª–∞

‚úÖ **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏—è**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç —Ü–∏—Ñ—Ä–æ–π –æ—Ç 1 –¥–æ 7
- 1 = –ê–ø–∞—Ç–∏—è, 2 = –ü–∞—Å—Å–∏–≤–Ω–æ—Å—Ç—å, 3 = –†–∞—Å—Å–ª–∞–±–ª–µ–Ω–Ω–æ—Å—Ç—å
- 4 = –ë–∞–ª–∞–Ω—Å, 5 = –í–∫–ª—é—á–µ–Ω–Ω–æ—Å—Ç—å, 6 = –ü–µ—Ä–µ–≤–æ–∑–±—É–∂–¥–µ–Ω–Ω–æ—Å—Ç—å, 7 = –ü–∞–Ω–∏–∫–∞
- –í—Å–µ –æ—Ç–≤–µ—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î

‚úÖ **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**
- –¢–∞–±–ª–∏—Ü–∞ `users` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —Ä–∏—Ç—É–∞–ª–æ–≤
- –¢–∞–±–ª–∏—Ü–∞ `mood_logs` - –∏—Å—Ç–æ—Ä–∏—è —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏—è

## üì¶ –®–∞–≥ 1: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ë–î

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ë–î –∑–∞–ø—É—â–µ–Ω–∞
sudo docker compose up -d db

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
cat 003_users_rituals.sql | sudo docker exec -i tasker_max_db psql -U tasker_user -d tasker

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã
sudo docker exec -it tasker_max_db psql -U tasker_user -d tasker -c "\dt"
```

–î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è —Ç–∞–±–ª–∏—Ü—ã:
- ‚úÖ `users`
- ‚úÖ `mood_logs`

## üöÄ –®–∞–≥ 2: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–π –±–æ—Ç (Ctrl+C)

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ
python longpolling_bot.py
```

## üß™ –®–∞–≥ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞

```
1. –í MAX –Ω–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å –¥–∏–∞–ª–æ–≥" –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: (–Ω–∞–∂–∏–º–∞–µ—Ç "–ù–∞—á–∞—Ç—å")
ü§ñ –ë–æ—Ç: –ü—Ä–∏–≤–µ—Ç, –î–∞–Ω–∏–∏–ª! üëã
        –≠—Ç–æ—Ç —Ç–∞—Å–∫–µ—Ä –±–æ—Ç –ø–æ–º–æ–∂–µ—Ç –¥–µ—Ä–∂–∞—Ç—å —Ç–≤–æ–µ –º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ 
        —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –±–∞–ª–∞–Ω—Å–µ, –ø–æ–≤—ã—à–∞—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å.
        
        –î–∞–≤–∞–π –Ω–∞—Å—Ç—Ä–æ–∏–º –≤—Ä–µ–º—è —É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Ä–∏—Ç—É–∞–ª–∞.
        –£–∫–∞–∂–∏ –≤—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ –ß–ß:–ú–ú (–Ω–∞–ø—Ä–∏–º–µ—Ä, 08:00)

üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: 08:00
ü§ñ –ë–æ—Ç: ‚úÖ –û—Ç–ª–∏—á–Ω–æ! –£—Ç—Ä–µ–Ω–Ω–∏–π —Ä–∏—Ç—É–∞–ª –Ω–∞—Å—Ç—Ä–æ–µ–Ω.
        
        –¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π –Ω–∞—Å—Ç—Ä–æ–∏–º –≤—Ä–µ–º—è –≤–µ—á–µ—Ä–Ω–µ–≥–æ —Ä–∏—Ç—É–∞–ª–∞.
        –£–∫–∞–∂–∏ –≤—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ –ß–ß:–ú–ú (–Ω–∞–ø—Ä–∏–º–µ—Ä, 21:00)

üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: 21:00
ü§ñ –ë–æ—Ç: ‚úÖ –û—Ç–ª–∏—á–Ω–æ! –í–µ—á–µ—Ä–Ω–∏–π —Ä–∏—Ç—É–∞–ª –Ω–∞—Å—Ç—Ä–æ–µ–Ω.
        
        üéâ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!
        
        –Ø –±—É–¥—É —Å–ø—Ä–∞—à–∏–≤–∞—Ç—å –æ —Ç–≤–æ–µ–º —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–∏ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è.
        –ò—Å–ø–æ–ª—å–∑—É–π /–ø–æ–º–æ—â—å —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥–∞—Ö.
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ö–æ–º–∞–Ω–¥–∞ /start

```
üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: /start
ü§ñ –ë–æ—Ç: –ü—Ä–∏–≤–µ—Ç, –î–∞–Ω–∏–∏–ª! üëã
        (–ø—Ä–æ—Ü–µ—Å—Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ)
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –û—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å –æ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–∏

```
üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: 5
ü§ñ –ë–æ—Ç: ‚úÖ –ó–∞–ø–∏—Å–∞–Ω–æ: 5 - –í–∫–ª—é—á–µ–Ω–Ω–æ—Å—Ç—å
        
        –°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ç–≤–µ—Ç! –•–æ—Ä–æ—à–µ–≥–æ –¥–Ω—è! üåü
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –≤—Ä–µ–º–µ–Ω–∏

```
üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: 25:00
ü§ñ –ë–æ—Ç: ‚ö†Ô∏è –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –≤—Ä–µ–º–µ–Ω–∏.
        –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏ –≤—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ –ß–ß:–ú–ú (–Ω–∞–ø—Ä–∏–º–µ—Ä, 08:00)
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

```bash
sudo docker exec -it tasker_max_db psql -U tasker_user -d tasker -c "SELECT * FROM users;"
```

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–ø–∏—Å–∏ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏—è

```bash
sudo docker exec -it tasker_max_db psql -U tasker_user -d tasker -c "SELECT * FROM mood_logs ORDER BY logged_at DESC LIMIT 10;"
```

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –µ–≥–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏

```bash
sudo docker exec -it tasker_max_db psql -U tasker_user -d tasker -c "
SELECT 
  max_user_id,
  first_name,
  morning_ritual_time,
  evening_ritual_time,
  onboarding_step
FROM users 
LIMIT 10;
"
```

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü

### –¢–∞–±–ª–∏—Ü–∞ `users`

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | BIGSERIAL | –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π ID |
| `max_user_id` | BIGINT | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ MAX |
| `first_name` | VARCHAR(255) | –ò–º—è |
| `last_name` | VARCHAR(255) | –§–∞–º–∏–ª–∏—è |
| `morning_ritual_time` | TIME | –í—Ä–µ–º—è —É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Ä–∏—Ç—É–∞–ª–∞ |
| `evening_ritual_time` | TIME | –í—Ä–µ–º—è –≤–µ—á–µ—Ä–Ω–µ–≥–æ —Ä–∏—Ç—É–∞–ª–∞ |
| `timezone` | VARCHAR(50) | –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é UTC) |
| `onboarding_step` | VARCHAR(50) | –®–∞–≥ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞ |
| `created_at` | TIMESTAMPTZ | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |
| `updated_at` | TIMESTAMPTZ | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |

### –¢–∞–±–ª–∏—Ü–∞ `mood_logs`

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | BIGSERIAL | ID –∑–∞–ø–∏—Å–∏ |
| `user_id` | BIGINT | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `mood_level` | INT | –£—Ä–æ–≤–µ–Ω—å (1-7) |
| `ritual_type` | VARCHAR(20) | –¢–∏–ø —Ä–∏—Ç—É–∞–ª–∞ (morning/evening) |
| `notes` | TEXT | –ó–∞–º–µ—Ç–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) |
| `logged_at` | TIMESTAMPTZ | –í—Ä–µ–º—è –∑–∞–ø–∏—Å–∏ |

## üéØ –£—Ä–æ–≤–Ω–∏ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏—è

| –£—Ä–æ–≤–µ–Ω—å | –ù–∞–∑–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|----------|
| 1 | –ê–ø–∞—Ç–∏—è | –ù–∏–∑–∫–∞—è —ç–Ω–µ—Ä–≥–∏—è, –Ω–µ—Ç –º–æ—Ç–∏–≤–∞—Ü–∏–∏ |
| 2 | –ü–∞—Å—Å–∏–≤–Ω–æ—Å—Ç—å | –†–∞—Å—Å–ª–∞–±–ª–µ–Ω, –Ω–æ –ø–∞—Å—Å–∏–≤–µ–Ω |
| 3 | –†–∞—Å—Å–ª–∞–±–ª–µ–Ω–Ω–æ—Å—Ç—å | –°–ø–æ–∫–æ–π–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ |
| 4 | –ë–∞–ª–∞–Ω—Å | –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ |
| 5 | –í–∫–ª—é—á–µ–Ω–Ω–æ—Å—Ç—å | –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å |
| 6 | –ü–µ—Ä–µ–≤–æ–∑–±—É–∂–¥–µ–Ω–Ω–æ—Å—Ç—å | –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —ç–Ω–µ—Ä–≥–∏–∏ |
| 7 | –ü–∞–Ω–∏–∫–∞ | –¢—Ä–µ–≤–æ–≥–∞, —Å—Ç—Ä–µ—Å—Å |

## üîÑ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (TODO)

–î–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Ä–∏—Ç—É–∞–ª–æ–≤ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:

1. ‚è∞ **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á (scheduler)**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `asyncio` –∏–ª–∏ `APScheduler`
   - –ü—Ä–æ–≤–µ—Ä—è—Ç—å –≤—Ä–µ–º—è –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

2. üåç **–ß–∞—Å–æ–≤—ã–µ –ø–æ—è—Å–∞**
   - –û–ø—Ä–µ–¥–µ–ª—è—Ç—å —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

3. üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**
   - –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏—Å—Ç–æ—Ä–∏–∏ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏—è
   - –ì—Ä–∞—Ñ–∏–∫–∏ –∏ —Ç—Ä–µ–Ω–¥—ã

4. üîî **–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è**
   - –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª –Ω–∞ —Ä–∏—Ç—É–∞–ª
   - –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ N –º–∏–Ω—É—Ç

## üí° –¢–µ–∫—É—â–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

‚úÖ –û–Ω–±–æ—Ä–¥–∏–Ω–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç  
‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∏—Ç—É–∞–ª–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç  
‚úÖ –ó–∞–ø–∏—Å—å —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç  
‚è≥ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é - –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å  

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ë–î –∑–∞–ø—É—â–µ–Ω–∞
sudo docker ps | grep tasker_max_db

# –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –≤—Ä—É—á–Ω—É—é
sudo docker exec -it tasker_max_db psql -U tasker_user -d tasker

# –í psql –≤—ã–ø–æ–ª–Ω–∏—Ç—å:
\i /path/to/003_users_rituals.sql
```

### –¢–∞–±–ª–∏—Ü—ã –Ω–µ —Å–æ–∑–¥–∞–ª–∏—Å—å

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã
sudo docker exec -it tasker_max_db psql -U tasker_user -d tasker -c "\dt"

# –°–æ–∑–¥–∞—Ç—å –≤—Ä—É—á–Ω—É—é
cat 003_users_rituals.sql | sudo docker exec -i tasker_max_db psql -U tasker_user -d tasker
```

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ /start

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ `users` —Å–æ–∑–¥–∞–Ω–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –Ω–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ë–î

---

**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–î–∞—Ç–∞:** 13.11.2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –û–Ω–±–æ—Ä–¥–∏–Ω–≥ –≥–æ—Ç–æ–≤, –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ - –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

